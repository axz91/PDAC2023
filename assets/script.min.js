function getMeta(e){var t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n].getAttribute("content");return""}function offsetURL(e){var t=getMeta("distill:offset");return t?t+"/"+e:e}function createFuseIndex(){var e={keys:[{name:"title",weight:20},{name:"categories",weight:15},{name:"description",weight:10},{name:"contents",weight:5},],ignoreLocation:!0,threshold:0},t=new window.Fuse([],e);return fetch(offsetURL("search.json")).then(function(e){return 200==e.status?e.json().then(function(e){return e.articles.forEach(function(e){t.add(e)}),Promise.all(e.collections.map(function(e){return fetch(offsetURL(e)).then(function(e){return 200===e.status?e.json().then(function(e){e.forEach(function(e){t.add(e)})}):Promise.reject(Error("Unexpected status from search index request: "+e.status))})})).then(function(){return t})}):Promise.reject(Error("Unexpected status from search index request: "+e.status))})}function is_downlevel_browser(){return!!bowser.isUnsupportedBrowser({msie:"12",msedge:"16"},window.navigator.userAgent)||void 0===window.load_distill_framework}function on_load_complete(){if(window.anchors&&(window.anchors.options.placement="left",window.anchors.add("d-article > h2, d-article > h3, d-article > h4, d-article > h5")),document.body.style.visibility="visible",window.HTMLWidgets){var e=window.HTMLWidgets.findAll(".leaflet");$.each(e,function(e,t){var n=this.getMap();n.invalidateSize(),n.eachLayer(function(e){e instanceof L.TileLayer&&e.redraw()})})}$("d-article").trigger("shown")}function init_distill(){init_common();var e=$("<d-front-matter></d-front-matter>");$("#distill-front-matter").wrap(e),$(".d-title").changeElementType("d-title");var t=$("<d-byline></d-byline>");$(".d-byline").replaceWith(t);var n=$("<d-article></d-article>");$(".d-article").wrap(n).children().unwrap(),$(".posts-container").appendTo($("d-article")),$(".d-appendix").changeElementType("d-appendix");var i=$(".appendix-bottom").children("h3").length>0;function a(){if(window.distillRunlevel&&!(window.distillRunlevel<4)){var e,t,n=JSON.parse($("#distill-front-matter").html());n.authors&&n.authors.length>0||$("d-byline").addClass("hidden"),$(".d-contents").parent().addClass("d-article-with-toc"),$(".authors-affiliations").find('a[href="#"]').removeAttr("href"),$(".authors-affiliations").find(".author").each(function(e,t){var i=n.authors[e].orcidID;if(i){var a=$("<a></a>");a.attr("href","https://orcid.org/"+i);var o=$("<img></img>");o.addClass("orcid-id"),o.attr("alt","ORCID ID"),o.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="),a.append(o),$(this).append(a)}});for(var i=!1,a=0;a<n.authors.length;++a)if("&nbsp;"!==n.authors[a].affiliation){i=!0;break}i||$("d-byline").find('h3:contains("Affiliations")').css("visibility","hidden"),n.publishedDate||d("Published");var s=$("d-byline").find('h3:contains("DOI")'),r=s.next().empty();if(n.doi?$("<a></a>").attr("href","https://doi.org/"+n.doi).html(n.doi).appendTo(r):$("#citation").length>0&&n.citationText?(s.html("Citation"),$('<a href="#citation"></a>').text(n.citationText).appendTo(r)):d("DOI"),1===n.authors.length){var l=$(".authors-affiliations");l.children('h3:contains("Authors")').text("Author"),l.children('h3:contains("Affiliations")').text("Affiliation")}$("d-appendix > style:first-child").remove(),$("d-footnote-list > style:first-child").remove(),$(".appendix-bottom").appendTo("d-appendix").children().unwrap(),$(".appendix-bottom").remove(),$("span.citation[data-cites]").each(function(){var e=$(this).attr("data-cites").split(" ").map(function(e){return"<p>"+$("#ref-"+e).html()+"</p>"}).join("\n");window.tippy(this,{allowHTML:!0,content:e,maxWidth:500,interactive:!0,interactiveBorder:10,theme:"light-border",placement:"bottom-start"})}),clearInterval(o),on_load_complete()}function d(e){$("d-byline").find('h3:contains("'+e+'")').parent().css("visibility","hidden")}}$(".footnote-ref").each(function(e,t){i=!0;var n=$(this).attr("href").replace("#","");$("#"+n);var a=$("#"+n+">p");a.find(".footnote-back").remove();var o=a.html(),s=$("<d-footnote></d-footnote>");s.html(o),$(this).replaceWith(s)}),$(".footnotes").remove(),$("#references-listing").replaceWith($("#refs")),$("h1.appendix, h2.appendix").each(function(e,t){$(this).changeElementType("h3")}),$("h3.appendix").each(function(e,t){var n=$(this).attr("id");$('.d-contents a[href="#'+n+'"]').parent().remove(),i=!0,$(this).nextUntil($("h1, h2, h3")).addBack().appendTo($("d-appendix"))}),$("d-appendix").css("display",i?"grid":"none"),$(".layout-chunk").each(function(e,t){var n=$(this).attr("data-layout");$(this).children().not("details, div.sourceCode, pre, script").each(function(e,t){var i=$('<div class="'+n+'"></div>');if(i.hasClass("shaded")){var a=$('<div class="shaded-content"></div>');$(this).wrap(a),$(this).parent().wrap(i)}else $(this).wrap(i)}),$(this).children().unwrap()}),$(".distill-force-highlighting-css").parent().remove(),$("code.sourceCode a:empty").remove(),load_distill_framework();var o=setInterval(a,50);a()}function init_downlevel(){init_common(),$(".d-title").after($('<hr class="section-separator"/>'));var e=JSON.parse($("#distill-front-matter").html());e.authors&&e.authors.length>0||$(".d-byline").remove(),$(".d-byline").after($('<hr class="section-separator"/>')),$(".d-byline a").remove(),$(".d-contents").remove(),$("h1.appendix, h2.appendix").each(function(e,t){$(this).changeElementType("h3")}),$("h3.appendix").each(function(e,t){$(this).nextUntil($("h1, h2, h3")).addBack().appendTo($(".d-appendix"))});var t=$("<h3></h3>");t.text("References"),$("#refs").prepend(t);var n=$("<h3></h3");n.text("Footnotes"),$(".footnotes").children("hr").first().replaceWith(n),$(".appendix-bottom").appendTo(".d-appendix").children().unwrap(),$(".appendix-bottom").remove(),0===$(".d-appendix").children().length&&$(".d-appendix").remove(),$(".d-appendix").before($('<hr class="section-separator" style="clear: both"/>')),$("pre>code").each(function(e,t){$(this).html($.trim($(this).html()))}),$(".posts-container").insertBefore($(".d-article")),$("body").addClass("downlevel"),on_load_complete()}function init_common(){var e;(e=jQuery).fn.changeElementType=function(t){var n={};e.each(this[0].attributes,function(e,t){n[t.nodeName]=t.nodeValue}),this.replaceWith(function(){return e("<"+t+"/>",n).append(e(this).contents())})},$("a > img").parent().css({"border-bottom":"none"}),$(".layout-chunk").each(function(e,t){var n=$(this).find("img, .html-widget");"l-body"!==$(this).attr("data-layout")?n.css("width","100%"):(n.css("max-width","100%"),n.filter("[width]").each(function(e,t){var n=$(this);n.css("width",n.attr("width")+"px")}))}),$(".post-preview").each(function(e,t){"file:"===window.location.protocol&&$(this).attr("href",$(this).attr("href")+"index.html")}),"file:"!==window.location.protocol&&$(".distill-site-header a[href]").each(function(e,t){$(this).attr("href",$(this).attr("href").replace("index.html","./"))}),$("tr.header").parent("thead").parent("table").addClass("pandoc-table"),$(".kable-table").children("table").addClass("pandoc-table"),$("caption").parent("table").addClass("figcaption"),window.init_posts_list&&window.init_posts_list(),$(".disqus-comment-count").click(function(){if(window.headroom_prevent_pin=!0,$("#disqus_thread").toggleClass("hidden"),!$("#disqus_thread").hasClass("hidden")){var e=$(this).offset();$(window).resize(),$("html, body").animate({scrollTop:e.top-35})}})}window.headroom_prevent_pin=!1,window.document.addEventListener("DOMContentLoaded",function(e){var t=$("header").get(0),n=t.offsetHeight,i=new Headroom(t,{tolerance:5,onPin:function(){window.headroom_prevent_pin&&(window.headroom_prevent_pin=!1,i.unpin())}});i.init(),window.location.hash&&i.unpin(),$(t).addClass("headroom--transition"),window.addEventListener("hashchange",function(e){window.scrollTo(0,window.pageYOffset-(n+25))}),$(".distill-site-header").each(function(e,t){var n=$(this);n.find(".nav-toggle").on("click",function(){n.toggleClass("responsive")})}),$(".nav-dropbtn").click(function(e){$(this).next(".nav-dropdown-content").toggleClass("nav-dropdown-active"),$(this).parent().siblings(".nav-dropdown").children(".nav-dropdown-content").removeClass("nav-dropdown-active")}),$("body").click(function(e){$(".nav-dropdown-content").removeClass("nav-dropdown-active")}),$(".nav-dropdown").click(function(e){e.stopPropagation()})}),window.document.addEventListener("DOMContentLoaded",function(e){var t=window.document.getElementById("distill-search");t&&createFuseIndex().then(function(e){t.classList.remove("hidden");var n={autoselect:!0,hint:!1,minLength:2};window.autocomplete(t,n,[{source:function(t,n){let i={isCaseSensitive:!1,shouldSort:!0,minMatchCharLength:2,limit:10};n(e.search(t,i).map(function(e){return e.item}))},templates:{suggestion:function(e){return`
                <div class="search-item">
                  <h3>${e.title}</h3>
                  <div class="search-item-description">
                    ${e.description||""}
                  </div>
                  <div class="search-item-preview">
                    ${e.preview&&Object.keys(e.preview).length>0?`<img src="${offsetURL(e.preview)}"</img>`:""}
                  </div>
                </div>
              `}}}]).on("autocomplete:selected",function(e,t){window.location.href=offsetURL(t.path)}),$(".algolia-autocomplete").css("display","")}).catch(function(e){console.log(e)})}),document.addEventListener("DOMContentLoaded",function(){is_downlevel_browser()?init_downlevel():window.addEventListener("WebComponentsReady",init_distill)}),function(){window.HTMLWidgets=window.HTMLWidgets||{};var viewerMode=window.HTMLWidgets.viewerMode=/\bviewer_pane=1\b/.test(window.location),shinyMode=window.HTMLWidgets.shinyMode=void 0!==window.Shiny&&!!window.Shiny.outputBindings;function querySelectorAll(e,t){return"undefined"!=typeof jQuery&&e instanceof jQuery?e.find(t):e.querySelectorAll?e.querySelectorAll(t):void 0}function asArray(e){return null===e?[]:$.isArray(e)?e:[e]}function extend(e){if(1==arguments.length)return e;for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e}function forEach(e,t,n){if(e.forEach)e.forEach(t,n);else for(var i=0;i<e.length;i++)t.call(n,e[i],i,e)}function overrideMethod(e,t,n){var i=e[t]||function(){},a=function(){return i.apply(e,arguments)};e[t]=n(a)}function delegateMethod(e,t,n){var i=e[n];e[n]=function(){var a=t,o=t[n];if(o||(a=e,o=i),o)return o.apply(a,arguments)}}function elementData(e,t,n){if(2==arguments.length)return e["htmlwidget_data_"+t];if(3==arguments.length)return e["htmlwidget_data_"+t]=n,e;throw Error("Wrong number of arguments for elementData: "+arguments.length)}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function hasClass(e,t){return RegExp("\\b"+escapeRegExp(t)+"\\b").test(e.className)}function filterByClass(e,t,n){for(var i=[],a=0;a<e.length;a++)hasClass(e[a],t)==n&&i.push(e[a]);return i}function on(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent(t,n)}function off(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent(t,n)}function unpackPadding(e){return("number"==typeof e&&(e=[e]),1===e.length)?{top:e[0],right:e[0],bottom:e[0],left:e[0]}:2===e.length?{top:e[0],right:e[1],bottom:e[0],left:e[1]}:3===e.length?{top:e[0],right:e[1],bottom:e[2],left:e[1]}:4===e.length?{top:e[0],right:e[1],bottom:e[2],left:e[3]}:void 0}function paddingToCss(e){return e.top+"px "+e.right+"px "+e.bottom+"px "+e.left+"px"}function px(e){return"number"==typeof e?e+"px":e}function sizingPolicy(e){var t=document.querySelector("script[data-for='"+e.id+"'][type='application/htmlwidget-sizing']");if(!t)return null;var n=JSON.parse(t.textContent||t.text||"{}");return viewerMode?n.viewer:n.browser}function evalAndRun(e,t,n){e&&forEach(e,function(e){var i=n;"object"==typeof e&&(i=i.concat([e.data]),e=e.code);var a=tryEval(e);if("function"!=typeof a)throw Error("Task must be a function! Source:\n"+e);a.apply(t,i)})}function tryEval(code){var result=null;try{result=eval("("+code+")")}catch(error){if(!(error instanceof SyntaxError))throw error;try{result=eval(code)}catch(e){if(e instanceof SyntaxError)throw error;throw e}}return result}function initSizing(e){var t=sizingPolicy(e);if(t){var n=document.getElementById("htmlwidget_container");if(n){if(void 0!==t.padding&&(document.body.style.margin="0",document.body.style.padding=paddingToCss(unpackPadding(t.padding))),!t.fill)return e.style.width=px(t.width),e.style.height=px(t.height),{getWidth:function(){return e.offsetWidth},getHeight:function(){return e.offsetHeight}};if(document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.width="100%",document.documentElement.style.height="100%",n){n.style.position="absolute";var i=unpackPadding(t.padding);n.style.top=i.top+"px",n.style.right=i.right+"px",n.style.bottom=i.bottom+"px",n.style.left=i.left+"px",e.style.width="100%",e.style.height="100%"}return{getWidth:function(){return n.offsetWidth},getHeight:function(){return n.offsetHeight}}}}}var defaults={find:function(e){return querySelectorAll(e,"."+this.name)},renderError:function(e,t){var n=$(e);this.clearError(e);var i="shiny-output-error";null!==t.type&&(i=i+" "+$.map(asArray(t.type),function(e){return i+"-"+e}).join(" ")),i+=" htmlwidgets-error";var a=n.css("display");if(n.data("restore-display-mode",a),"inline"===a||"inline-block"===a){if(n.hide(),""!==t.message){var o=$("<span>").addClass(i);o.text(t.message),n.after(o)}}else if("block"===a&&(n.css("visibility","hidden"),""!==t.message)){var s=$("<div>").addClass(i).css("position","absolute").css("top",e.offsetTop).css("left",e.offsetLeft).css("maxWidth",e.offsetWidth).css("height",e.offsetHeight);s.text(t.message),n.after(s);var r=setInterval(function(){if(!s[0].parentElement){clearInterval(r);return}s.css("top",e.offsetTop).css("left",e.offsetLeft).css("maxWidth",e.offsetWidth).css("height",e.offsetHeight)},500)}},clearError:function(e){var t=$(e),n=t.data("restore-display-mode");t.data("restore-display-mode",null),"inline"===n||"inline-block"===n?(n&&t.css("display",n),$(e.nextSibling).filter(".htmlwidgets-error").remove()):"block"===n&&(t.css("visibility","inherit"),$(e.nextSibling).filter(".htmlwidgets-error").remove())},sizing:{}};window.HTMLWidgets.widget=function(e){if(!e.name)throw Error("Widget must have a name");if(!e.type)throw Error("Widget must have a type");if("output"!==e.type)throw Error("Unrecognized widget type '"+e.type+"'");if(e.factory&&(e=createLegacyDefinitionAdapter(e)),!e.renderValue)throw Error("Widget must have a renderValue function");window.HTMLWidgets.widgets=window.HTMLWidgets.widgets||[];var t=extend({},defaults,e);if(overrideMethod(t,"find",function(e){return function(t){return filterByClass(e(t),"html-widget-output",!1)}}),window.HTMLWidgets.widgets.push(t),shinyMode){var n=extend({},defaults,e),i=new Shiny.OutputBinding;delegateMethod(i,n,"getId"),delegateMethod(i,n,"onValueChange"),delegateMethod(i,n,"onValueError"),delegateMethod(i,n,"renderError"),delegateMethod(i,n,"clearError"),delegateMethod(i,n,"showProgress"),i.find=function(e){var t=n.find(e),i=t.filter(".html-widget-output");return t.length!==i.length&&scheduleStaticRender(),i},i.renderValue=function(e,t){Shiny.renderDependencies(t.deps),t.evals instanceof Array||(t.evals=[t.evals]);for(var i=0;t.evals&&i<t.evals.length;i++)window.HTMLWidgets.evaluateStringMember(t.x,t.evals[i]);if(!n.renderOnNullValue){if(null===t.x){e.style.visibility="hidden";return}e.style.visibility="inherit"}if(!elementData(e,"initialized")&&(initSizing(e),elementData(e,"initialized",!0),n.initialize)){var a=n.initialize(e,e.offsetWidth,e.offsetHeight);elementData(e,"init_result",a)}n.renderValue(e,t.x,elementData(e,"init_result")),evalAndRun(t.jsHooks.render,elementData(e,"init_result"),[e,t.x])},n.resize&&(i.resize=function(e,t,i){elementData(e,"initialized")&&n.resize(e,t,i,elementData(e,"init_result"))}),Shiny.outputBindings.register(i,n.name)}};var scheduleStaticRenderTimerId=null;function scheduleStaticRender(){scheduleStaticRenderTimerId||(scheduleStaticRenderTimerId=setTimeout(function(){scheduleStaticRenderTimerId=null,window.HTMLWidgets.staticRender()},1))}function has_jQuery3(){return!!window.jQuery&&parseInt(window.jQuery.fn.jquery.split(".")[0])>=3}function maybeStaticRenderLater(){shinyMode&&has_jQuery3()?window.jQuery(window.HTMLWidgets.staticRender):window.HTMLWidgets.staticRender()}function splitWithEscape(e,t,n){for(var i=[],a=!1,o="",s=0;s<e.length;s++)a?(o+=e[s],a=!1):e[s]===t?(i.push(o),o=""):e[s]===n?a=!0:o+=e[s];return""!==o&&i.push(o),i}window.HTMLWidgets.staticRender=function(){forEach(window.HTMLWidgets.widgets||[],function(e){forEach(e.find(document.documentElement),function(t){var n,i=initSizing(t,e);if(!hasClass(t,"html-widget-static-bound")){if(t.className=t.className+" html-widget-static-bound",e.initialize&&(n=e.initialize(t,i?i.getWidth():t.offsetWidth,i?i.getHeight():t.offsetHeight),elementData(t,"init_result",n)),e.resize){var a={w:i?i.getWidth():t.offsetWidth,h:i?i.getHeight():t.offsetHeight},o=function(o){var s={w:i?i.getWidth():t.offsetWidth,h:i?i.getHeight():t.offsetHeight};(0!==s.w||0!==s.h)&&(s.w!==a.w||s.h!==a.h)&&(a=s,e.resize(t,s.w,s.h,n))};on(window,"resize",o),window.jQuery&&(window.jQuery(document).on("shown.htmlwidgets shown.bs.tab.htmlwidgets shown.bs.collapse.htmlwidgets",o),window.jQuery(document).on("hidden.htmlwidgets hidden.bs.tab.htmlwidgets hidden.bs.collapse.htmlwidgets",o)),window.addEventListener&&(on(document,"slideenter",o),on(document,"slideleave",o))}var s=document.querySelector("script[data-for='"+t.id+"'][type='application/json']");if(s){var r=JSON.parse(s.textContent||s.text);r.evals instanceof Array||(r.evals=[r.evals]);for(var l=0;r.evals&&l<r.evals.length;l++)window.HTMLWidgets.evaluateStringMember(r.x,r.evals[l]);e.renderValue(t,r.x,n),evalAndRun(r.jsHooks.render,n,[t,r.x])}}})}),invokePostRenderHandlers()},document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),maybeStaticRenderLater()},!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),maybeStaticRenderLater())}),window.HTMLWidgets.getAttachmentUrl=function(e,t){void 0===t&&(t=1);var n=document.getElementById(e+"-"+t+"-attachment");if(!n)throw Error("Attachment "+e+"/"+t+" not found in document");return n.getAttribute("href")},window.HTMLWidgets.dataframeToD3=function(e){var t,n,i=[];for(var a in e){if(e.hasOwnProperty(a)&&i.push(a),"object"!=typeof e[a]||void 0===e[a].length)throw Error("All fields must be arrays");if(void 0!==t&&t!==e[a].length)throw Error("All fields must be arrays of the same length");t=e[a].length}for(var o=[],s=0;s<t;s++){n={};for(var r=0;r<i.length;r++)n[i[r]]=e[i[r]][s];o.push(n)}return o},window.HTMLWidgets.transposeArray2D=function(e){return 0===e.length?e:e[0].map(function(t,n){return e.map(function(e){return e[n]})})},window.HTMLWidgets.evaluateStringMember=function(e,t){for(var n=splitWithEscape(t,".","\\"),i=0,a=n.length;i<a;i++){var o=n[i];null!==e&&"object"==typeof e&&o in e&&(i==a-1?"string"==typeof e[o]&&(e[o]=tryEval(e[o])):e=e[o])}},window.HTMLWidgets.getInstance=function(e){return elementData(e,"init_result")},window.HTMLWidgets.find=function(e,t){1==arguments.length&&(t=e,e=document);var n=e.querySelector(t);return null===n?null:window.HTMLWidgets.getInstance(n)},window.HTMLWidgets.findAll=function(e,t){1==arguments.length&&(t=e,e=document);for(var n=e.querySelectorAll(t),i=[],a=0;a<n.length;a++)i.push(window.HTMLWidgets.getInstance(n[a]));return i};var postRenderHandlers=[];function invokePostRenderHandlers(){for(;postRenderHandlers.length;){var e=postRenderHandlers.shift();e&&e()}}function createLegacyDefinitionAdapter(e){var t={name:e.name,type:e.type,initialize:function(t,n,i){return e.factory(t,n,i)},renderValue:function(e,t,n){return n.renderValue(t)},resize:function(e,t,n,i){return i.resize(t,n)}};return e.find&&(t.find=e.find),e.renderError&&(t.renderError=e.renderError),e.clearError&&(t.clearError=e.clearError),t}window.HTMLWidgets.addPostRenderHandler=function(e){postRenderHandlers.push(e)}}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).vegaTooltip={})}(this,function(e){"use strict";var t={name:"vega-tooltip",version:"0.22.1",description:"A tooltip plugin for Vega-Lite and Vega visualizations.",main:"build/vega-tooltip.js",module:"build/src/index.js",unpkg:"build/vega-tooltip.min.js",jsdelivr:"build/vega-tooltip.min.js",typings:"build/src/index.d.ts",repository:{type:"git",url:"https://github.com/vega/vega-tooltip.git"},keywords:["vega-lite","vega","tooltip"],author:{name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},collaborators:["Dominik Moritz","Sira Horradarn","Zening Qu","Kanit Wongsuphasawat","Yuri Astrakhan","Jeffrey Heer"],license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-tooltip/issues"},homepage:"https://github.com/vega/vega-tooltip#readme",scripts:{prepare:"beemo create-config --silent","tsc:src":"tsc -b tsconfig.src.json",build:"yarn tsc:src && rollup -c",clean:"rm -rf build examples/data && rm -f src/style.ts","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && yarn copy:build && gh-pages -d examples && yarn clean",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint '{src,test,types}/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",postbuild:"terser build/vega-tooltip.js -c -m -o build/vega-tooltip.min.js",prebuild:"mkdir -p build && yarn copy:data && ./build-style.sh",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'browser-sync start -s -f build examples --serveStatic examples' 'yarn tsc:src -w' 'rollup -c -w'",pretest:"./build-style.sh",test:"jest"},devDependencies:{"@rollup/plugin-commonjs":"11.0.2","@rollup/plugin-json":"^4.0.2","@rollup/plugin-node-resolve":"^7.1.1","@types/jest":"^25.1.4","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",jest:"^25.1.0","node-sass":"^4.13.1",path:"^0.12.7",rollup:"^2.1.0",terser:"^4.6.7","ts-jest":"^25.2.1",typescript:"^3.8.3","vega-datasets":"^1.30.2","vega-lite-dev-config":"^0.5.0","vega-typings":"^0.14.2"},dependencies:{"vega-util":"^1.13.1"},beemo:{module:"vega-lite-dev-config",drivers:["prettier","eslint"]},jest:{testURL:"http://localhost/",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["node_modules","<rootDir>/build","src"]}},n=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;let i="vg-tooltip-element",a={offsetX:10,offsetY:10,id:i,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:o,maxDepth:2};function o(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function s(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw Error("Invalid HTML ID");return n.toString().replace(i,e)}function r(e,t,n){return e.fields=t||[],e.fname=n,e}function l(e){throw Error(e)}function d(e){var t,n,i,a=[],o=null,s=0,r=e.length,d="";function c(){a.push(d+e.substring(t,n)),d="",t=n+1}for(e+="",t=n=0;n<r;++n)if("\\"===(i=e[n]))d+=e.substring(t,n),d+=e.substring(++n,++n),t=n;else if(i===o)c(),o=null,s=-1;else{if(o)continue;t===s&&'"'===i?(t=n+1,o=i):t===s&&"'"===i?(t=n+1,o=i):"."!==i||s?"["===i?(n>t&&c(),s=t=n+1):"]"===i&&(s||l("Access path missing open bracket: "+e),s>0&&c(),s=0,t=n+1):n>t?c():t=n+1}return s&&l("Access path missing closing bracket: "+e),o&&l("Access path missing closing quote: "+e),n>t&&(n++,c()),a}var c=Array.isArray;function u(e){return e===Object(e)}function p(e){return"string"==typeof e}function h(e){return c(e)?"["+e.map(h)+"]":u(e)||p(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function f(e,t){var n=d(e);return r(Function("_","return _["+n.map(h).join("][")+"];"),[e=1===n.length?n[0]:e],t||e)}var g=[];f("id"),r(function(e){return e},g,"identity"),r(function(){return 0},g,"zero"),r(function(){return 1},g,"one"),r(function(){return!0},g,"true"),r(function(){return!1},g,"false");var m=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,i=Object.getOwnPropertySymbols(e);a<i.length;a++)0>t.indexOf(i[a])&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(n[i[a]]=e[i[a]]);return n};function v(e,t,n){if(c(e))return`[${e.map(e=>t(p(e)?e:b(e,n))).join(", ")}]`;if(u(e)){let i="",a=e,{title:o}=a,s=m(a,["title"]);o&&(i+=`<h2>${t(o)}</h2>`);let r=Object.keys(s);if(r.length>0){for(let l of(i+="<table>",r)){let d=s[l];void 0!==d&&(u(d)&&(d=b(d,n)),i+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(d)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function y(e){let t=[];return function(n,i){if("object"!=typeof i||null===i)return i;let a=t.indexOf(this)+1;return(t.length=a,t.length>e)?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function b(e,t){return JSON.stringify(e,y(t))}function x(e,t,n,i){let a=e.clientX+n;a+t.width>window.innerWidth&&(a=+e.clientX-n-t.width);let o=e.clientY+i;return o+t.height>window.innerHeight&&(o=+e.clientY-i-t.height),{x:a,y:o}}class w{constructor(e){this.options=Object.assign(Object.assign({},a),e);let t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){let n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=s(t);let i=document.head;i.childNodes.length>0?i.insertBefore(n,i.childNodes[0]):i.appendChild(n)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,i){if(null==i||""===i){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=v(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);let{x:a,y:o}=x(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${o}px; left: ${a}px`)}}let A=t.version;function _(e,t){let n=new w(t);return e.tooltip(n.call).run(),n}e.DEFAULT_OPTIONS=a,e.Handler=w,e.calculatePosition=x,e.createDefaultStyle=s,e.default=_,e.escapeHTML=o,e.formatValue=v,e.replacer=y,e.stringify=b,e.version=A,Object.defineProperty(e,"__esModule",{value:!0})});var _global="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function bom(e,t){return(void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type))?new Blob(["\uFEFF",e],{type:e.type}):e}function download(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){saveAs(i.response,t,n)},i.onerror=function(){console.error("could not download file")},i.send()}function corsEnabled(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(n){}return t.status>=200&&t.status<=299}function click(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var isMacOSWebView=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),saveAs=_global.saveAs||("object"!=typeof window||window!==_global?function e(){}:"download"in HTMLAnchorElement.prototype&&!isMacOSWebView?function e(t,n,i){var a=_global.URL||_global.webkitURL,o=document.createElement("a");n=n||t.name||"download",o.download=n,o.rel="noopener","string"==typeof t?(o.href=t,o.origin!==location.origin?corsEnabled(o.href)?download(t,n,i):click(o,o.target="_blank"):click(o)):(o.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(o.href)},4e4),setTimeout(function(){click(o)},0))}:"msSaveOrOpenBlob"in navigator?function e(t,n,i){if(n=n||t.name||"download","string"==typeof t){if(corsEnabled(t))download(t,n,i);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){click(a)})}}else navigator.msSaveOrOpenBlob(bom(t,i),n)}:function e(t,n,i,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof t)return download(t,n,i);var o="application/octet-stream"===t.type,s=/constructor/i.test(_global.HTMLElement)||_global.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||o&&s||isMacOSWebView)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=r?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},l.readAsDataURL(t)}else{var d=_global.URL||_global.webkitURL,c=d.createObjectURL(t);a?a.location=c:location.href=c,a=null,setTimeout(function(){d.revokeObjectURL(c)},4e4)}});function createXYSpec(e,t,n,i){var a=makeVegaTooltip(e.cols);if(-1!=e.annoCols)var o=e.annoCols.map(e=>e.toLowerCase()).indexOf("symbol"),s=o>=0?e.annoCols[o]:"symbol";return{$schema:"https://vega.github.io/schema/vega/v5.json",description:"Testing ground for GlimmaV2",width:-1==e.counts?.9*n:.5*n,height:.35*i,padding:{left:0,top:0,right:0,bottom:10},autosize:{type:"fit",resize:!0},title:{text:e.title},signals:[{name:"click",value:null,on:[{events:"mousedown",update:"[datum, now()]"}]}],data:[{name:"source",values:t,transform:[{type:"formula",expr:"datum.x",as:"tooltip"}]},{name:"selected_points"}],scales:[{name:"x",type:"linear",round:!0,nice:!0,zero:!0,domain:{data:"source",field:e.x},range:"width"},{name:"y",type:"linear",round:!0,nice:!0,zero:!0,domain:{data:"source",field:e.y},range:"height"},{name:"colour_scale",type:"ordinal",domain:["downReg","nonDE","upReg"],range:e.statusColours}],legends:[{fill:"colour_scale",title:"Status",symbolStrokeColor:"black",symbolStrokeWidth:1,symbolOpacity:.7,symbolType:"circle"}],axes:[{scale:"x",grid:!0,domain:!1,orient:"bottom",tickCount:5,title:e.x},{scale:"y",grid:!0,domain:!1,orient:"left",titlePadding:5,title:e.y}],marks:[{name:"marks",type:"symbol",from:{data:"source"},encode:{update:{x:{scale:"x",field:e.x},y:{scale:"y",field:e.y},shape:"circle",size:[{test:"datum.status == 0",value:5},{value:25}],opacity:{value:.65},fill:{scale:"colour_scale",field:"status"},strokeWidth:{value:1},stroke:{value:"transparent"},tooltip:a}}},{name:"selected_marks",type:"symbol",from:{data:"selected_points"},encode:{update:{x:{scale:"x",field:e.x},y:{scale:"y",field:e.y},shape:"circle",size:{value:120},fill:{scale:"colour_scale",field:"status"},strokeWidth:{value:1},stroke:{value:"black"},opacity:{value:1},tooltip:a}}},{name:"selected_text",type:"text",from:{data:"selected_points"},encode:{update:{x:{scale:"x",field:e.x},y:{scale:"y",field:e.y,offset:-10},fill:{value:"black"},fontWeight:{value:"bold"},opacity:{value:1},text:{field:-1==e.annoCols?"symbol":s},fontSize:{value:12}}}}]}}function createMDSSpec(e,t,n,i,a,o){console.log(n);var s="{'x':datum[x_axis], 'y':datum[y_axis]";n.all.forEach(function(e){"-"!=e&&"- "!=e&&(s+=`,'${e}':datum['${e}']`)}),s+="}",console.log(s);var r={signal:s},l=o?["reds","blues","tealblues","teals","greens","browns","oranges","reds","purples","warmgreys","greys","viridis","plasma","blueorange","redblue"]:["accent","category10","category20","category20b","category20c","dark2","paired","pastel1","pastel2","set1","set2","set3","tableau10","tableau20"];return{$schema:"https://vega.github.io/schema/vega/v5.json",description:"Testing ground for GlimmaV2",width:.5*i,height:.8*a,padding:0,autosize:{type:"fit",resize:!0},title:{text:"MDS Plot"},signals:[{name:"x_axis",value:t[0],bind:{input:"select",options:t}},{name:"y_axis",value:t[1],bind:{input:"select",options:t}},{name:"scale_by",value:n.numeric[0],bind:{input:"select",options:n.numeric}},{name:"colour_by",value:n.discrete[0],bind:{input:"select",options:o?n.numeric:n.discrete}},{name:"shape_by",value:n.discrete[0],bind:{input:"select",options:n.discrete}},{name:"colourscheme",value:l[1],bind:{input:"select",options:l}}],data:[{name:"source",values:e,transform:[{type:"formula",expr:"datum.x",as:"tooltip"}]}],scales:[{name:"x",type:"linear",round:!0,nice:!0,zero:!0,domain:{data:"source",field:{signal:"x_axis"}},range:"width"},{name:"y",type:"linear",round:!0,nice:!0,zero:!0,domain:{data:"source",field:{signal:"y_axis"}},range:"height"},{name:"size",type:"linear",round:!0,nice:!1,zero:!0,domain:{data:"source",field:{signal:"scale_by"}},range:[5,350]},{name:"color",type:o?"linear":"ordinal",domain:{data:"source",field:{signal:"colour_by"}},range:{scheme:{signal:"colourscheme"}}},{name:"shape",type:"ordinal",domain:{data:"source",field:{signal:"shape_by"}},range:["circle","square","diamond","triangle","triangle-up","cross"]}],axes:[{scale:"x",grid:!0,domain:!1,orient:"bottom",tickCount:5,title:{signal:"x_axis"}},{scale:"y",grid:!0,domain:!1,orient:"left",titlePadding:5,title:{signal:"y_axis"}}],legends:[{size:"size",title:"Scale",format:"s",symbolStrokeColor:"black",symbolStrokeWidth:.5,symbolOpacity:.9,symbolType:"circle"},{fill:"color",title:"Colour",symbolStrokeColor:"black",symbolStrokeWidth:.5,symbolOpacity:.9,symbolType:"circle"},{shape:"shape",title:"Shape",symbolStrokeColor:"black",symbolStrokeWidth:.5,symbolOpacity:.9},],marks:[{name:"marks",type:"symbol",from:{data:"source"},encode:{update:{x:{scale:"x",field:{signal:"x_axis"}},y:{scale:"y",field:{signal:"y_axis"}},size:{scale:"size",field:{signal:"scale_by"}},shape:{scale:"shape",field:{signal:"shape_by"}},fill:{scale:"color",field:{signal:"colour_by"}},strokeWidth:{value:.5},opacity:{value:.9},stroke:{value:"black"},tooltip:r}}}]}}function createEigenSpec(e,t,n){return{$schema:"https://vega.github.io/schema/vega/v5.json",description:"A basic bar chart example, with value labels shown upon mouse hover.",width:.35*t,height:.6*n,padding:0,title:{text:"Variance Explained"},data:[{name:"table",values:e}],signals:[{name:"tooltip",value:{},on:[{events:"rect:mouseover",update:"datum"},{events:"rect:mouseout",update:"{}"}]},{name:"external_select_x",value:1},{name:"external_select_y",value:2}],scales:[{name:"xscale",type:"band",domain:{data:"table",field:"name"},range:"width",padding:.05,round:!0},{name:"yscale",domain:{data:"table",field:"eigen"},range:"height"}],axes:[{orient:"bottom",scale:"xscale"},{orient:"left",scale:"yscale"}],marks:[{type:"rect",from:{data:"table"},encode:{enter:{x:{scale:"xscale",field:"name"},width:{scale:"xscale",band:1},y:{scale:"yscale",field:"eigen"},y2:{scale:"yscale",value:0}},update:{fill:[{test:"datum.name == external_select_x || datum.name == external_select_y",value:"#3d3f46"},{value:"#afafaf"}]}}},{type:"text",from:{data:"table"},encode:{enter:{align:{value:"center"},baseline:{value:"bottom"},fill:{value:"#333"}},update:{x:{scale:"xscale",field:"name",band:.5},y:{scale:"yscale",field:"eigen",offset:-2},text:{field:"eigen"},fillOpacity:[{test:"datum.name == external_select_x || datum.name == external_select_y",value:1},{value:0}]}}}]}}function createExpressionSpec(e,t,n,i,a){let o={name:"colourscheme",value:"category10",bind:{input:"select",options:["category10","accent","category20","category20b","category20c","dark2","paired","pastel1","pastel2","set1","set2","set3","tableau10","tableau20"]}},s={name:"samplecols_active"};return n.push("count"),{$schema:"https://vega.github.io/schema/vega/v5.json",width:.4*e,height:.35*t,padding:{left:0,top:0,right:0,bottom:10},autosize:{type:"fit",resize:!0},title:{text:{signal:"title_signal"}},signals:[{name:"title_signal",value:""},{name:"max_y_axis",value:null,bind:{input:"number",class:"max_y_axis"}},{name:"max_count",value:0},{name:"max_y",update:" (max_y_axis < max_count) ? null : max_y_axis"},-1==i?o:s],data:[{name:"table"}],scales:[{name:"x",type:"band",padding:1,domain:{data:"table",field:"group"},range:"width"},{name:"y",domain:{data:"table",field:"count"},range:"height",domainMax:{signal:"max_y"}},{name:"color",type:"ordinal",domain:-1==i?{data:"table",field:"group"}:a,range:-1==i?{scheme:{signal:"colourscheme"}}:i}],axes:[{scale:"x",orient:"bottom",title:"group",labelAngle:-45,labelAlign:"right",labelOffset:-3},{scale:"y",grid:!0,orient:"left",titlePadding:5,title:"expression"}],marks:[{name:"marks",type:"symbol",from:{data:"table"},encode:{update:{x:{scale:"x",field:"group"},y:{scale:"y",field:"count"},shape:{value:"circle"},fill:{scale:"color",field:-1==i?"group":"sample"},strokeWidth:{value:1},opacity:{value:.8},size:{value:100},stroke:{value:"#575757"},tooltip:makeVegaTooltip(n)}}}]}}function makeVegaTooltip(e){let t="{";return e.forEach(e=>t+=`'${e}':datum['${e}'],`),{signal:t+="}"}}function addSavePlotButton(e,t,n=null,i="Save Plot",a="Summary plot",o="Expression plot"){var s=document.createElement("div");s.setAttribute("class","dropdown");var r=document.createElement("button");r.setAttribute("class","save-button"),r.innerHTML=i;var l=document.createElement("div");l.setAttribute("class","dropdown-content");var d=addSaveButtonElement(t,i=a+" (PNG)",type="png"),c=addSaveButtonElement(t,i=a+" (SVG)",type="svg");if(s.appendChild(r),s.appendChild(l),l.appendChild(d),l.appendChild(c),n){var u=addSaveButtonElement(n,i=o+" (PNG)",type="png"),p=addSaveButtonElement(n,i=o+" (SVG)",type="svg");l.appendChild(u),l.appendChild(p)}if(r.onclick=function(){dropdownOnClick(l)},e.appendChild(s),!window.dropdownHide){function h(e){if(!e.target.matches(".save-button")){var t=document.getElementsByClassName("dropdown-content");for(let n of t)n.classList.contains("show")&&n.classList.remove("show")}}window.addEventListener("click",h),window.dropdownHide=!0}}function dropdownOnClick(e){var t=document.getElementsByClassName("dropdown-content");for(let n of t)n.classList.contains("show")&&n.classList.remove("show");e.classList.toggle("show")}function displayModal(e,t){var n=document.getElementById("myModal"),i=document.getElementById("close"),a=document.getElementById("modal-link"),o=document.createElement("a");o.innerHTML="Download Image",o.setAttribute("href",e),o.setAttribute("download","vega-export."+t),a.appendChild(o),o.click(),n.style.display="block",i.onclick=function(){n.style.display="none",a.removeChild(o)},window.onclick=function(e){e.target==n&&(a.removeChild(o),n.style.display="none")}}function addSaveButtonElement(e,t,n){var i=document.createElement("a");return i.setAttribute("href","#"),i.innerText=t,i.onclick=function(){e.toImageURL(n,scaleFactor=3).then(function(e){var t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","vega-export."+n),navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS")?displayModal(e,n):(t.setAttribute("target","_blank"),t.dispatchEvent(new MouseEvent("click")))})},i}function addSaveDataElement(e,t,n,i){buttonContainer=document.getElementsByClassName("saveSubset")[0].parentElement,document.createElement("div").setAttribute("class","dropdown");var a=document.createElement("div");a.setAttribute("class","dropdown-content dataDropdown");var o=document.createElement("a");o.setAttribute("href","#"),o.setAttribute("class","saveSelectButton"),o.innerText=i,o.onclick=function(){saveTableClickListener(e,t,!1)};var s=document.createElement("a");s.setAttribute("href","#"),s.innerText=n,s.onclick=function(){saveTableClickListener(e,t,!0)},a.appendChild(o),a.appendChild(s),buttonContainer.appendChild(a)}function saveTableClickListener(e,t,n){n?confirm(`This will save the table and counts data for all ${t.xyTable.length} genes.`)&&saveJSONArrayToCSV(null==t.countsMatrix?t.xyTable:t.xyTable.map(e=>$.extend(e,t.countsMatrix[e.index]))):saveJSONArrayToCSV(null==t.countsMatrix?e.selected:e.selected.map(e=>$.extend(e,t.countsMatrix[e.index])))}function saveJSONArrayToCSV(e){let t=JSONArrayToCSV(e);saveAs(new Blob([t],{type:"text/csv;charset=utf-8"}),"glimmaTable.csv")}function JSONArrayToCSV(e){var t=Object.keys(e[0]),n=function(e,t){return null===t?"":t},i=e.map(function(e){return t.map(function(t){return JSON.stringify(e[t],n)}).join(",")});return i.unshift(t.join(",")),i=i.join("\r\n")}_global.saveAs=saveAs.saveAs=saveAs,"undefined"!=typeof module&&(module.exports=saveAs),HTMLWidgets.widget({name:"glimmaXY",type:"output",factory:function(e,t,n){var i=document.createElement("div"),a=document.createElement("div");i.setAttribute("class","plotContainer"),a.setAttribute("class","controlContainer");var o=document.getElementById(e.id);return o.appendChild(i),o.appendChild(a),{renderValue:function(e){console.log(e);var o=new vegaTooltip.Handler,s=document.createElement("div");s.setAttribute("class","xyContainerSingle"),i.appendChild(s);var r=HTMLWidgets.dataframeToD3(e.data.table),l=createXYSpec(e.data,r,t,n),d=new vega.View(vega.parse(l),{renderer:"svg",container:s,bind:a,hover:!0});d.tooltip(o.call),d.runAsync();var c=null,u=null,p=null;if(-1!=e.data.counts){(p=document.createElement("div")).setAttribute("class","expressionContainer"),i.appendChild(p),s.setAttribute("class","xyContainer"),c=HTMLWidgets.dataframeToD3(e.data.counts);var h=createExpressionSpec(t,n,e.data.expCols,e.data.sampleColours,e.data.samples),u=new vega.View(vega.parse(h),{renderer:"svg",container:p,hover:!0});u.tooltip(o.call),u.runAsync()}var f={xyView:d,expressionView:u,xyTable:r,countsMatrix:c,controlContainer:a,height:n,cols:e.data.cols,groups:e.data.groups,levels:e.data.levels,expressionContainer:p};setupXYInteraction(f),addSavePlotButton(a,d,u,"Save Plot"),u&&addAxisMessage(f)},resize:function(e,t){}}}});class State{constructor(e){this.data=e,this.graphMode=!1,this._selected=[]}get selected(){return this._selected}set selected(e){this._selected=e;let t=e.map(e=>`<span>${e.gene}</span>`).join("");$(this.data.controlContainer.getElementsByClassName("geneDisplay")[0]).html(t),$(this.data.controlContainer.getElementsByClassName("saveSelectButton")[0]).html(`Save (${e.length})`),$(this.data.controlContainer.getElementsByClassName("clearSubset")[0]).html(`Clear (${e.length})`)}toggleGene(e){let t=containsGene(this.selected,e);this.selected=t>=0?remove(this.selected,t):this.selected.concat(e),this._expressionUpdateHandler(t<0,e)}_expressionUpdateHandler(e,t){if(this.data.expressionView){if(e)updateExpressionPlot(this.data.countsMatrix[t.index],this.data,t.gene);else if(this.selected.length>0){let n=this.selected[this.selected.length-1];updateExpressionPlot(this.data.countsMatrix[n.index],this.data,n.gene)}else clearExpressionPlot(this.data)}}}function setupXYInteraction(e){var t=new State(e),n=document.createElement("TABLE");n.setAttribute("class","dataTable"),e.controlContainer.appendChild(n),$(document).ready(function(){var i=$(n).DataTable({data:e.xyTable,columns:e.cols.map(e=>({data:e,title:e})),rowId:"gene",dom:'<"geneDisplay fade-in">Bfrtip',buttons:{dom:{buttonContainer:{tag:"div",className:"buttonContainer"}},buttons:[{text:"Clear (0)",action:()=>clearTableListener(i,t,e),attr:{class:"save-button clearSubset"}},{text:"Save Data",action:()=>showDataDropdown(),attr:{class:"save-button saveSubset"}}]},scrollY:(.4*e.height).toString()+"px",scrollX:!1,orderClasses:!1,stripeClasses:["stripe1","stripe2"]});i.on("click","tr",function(){tableClickListener(i,t,e,$(this))}),e.xyView.addSignalListener("click",function(n,a){XYSignalListener(i,t,a[0],e)}),$(document.getElementsByClassName("saveSubset")[0]).html("Save Data"),addSaveDataElement(t,e,"Save All","Save (0)")})}function showDataDropdown(){dropdownOnClick(document.getElementsByClassName("dataDropdown")[0])}function clearTableListener(e,t,n){t.graphMode=!1,t.selected=[],e.rows(".selected").nodes().to$().removeClass("selected"),e.search("").columns().search("").draw(),n.xyView.data("selected_points",t.selected),n.xyView.runAsync(),clearExpressionPlot(n),console.log(t)}function tableClickListener(e,t,n,i){if(t.graphMode)return;i.toggleClass("selected");let a=e.row(i).data();t.toggleGene(a),n.xyView.data("selected_points",t.selected),n.xyView.runAsync()}function XYSignalListener(e,t,n,i){if(null!=n){t.graphMode||(t.graphMode=!0,e.rows(".selected").nodes().to$().removeClass("selected"),t.selected=[]),t.toggleGene(n),0==t.selected.length&&(t.graphMode=!1),i.xyView.data("selected_points",t.selected),i.xyView.runAsync(),e.search("").columns().search("").draw();var a=t.selected.map(e=>"^"+e.gene+"$").join("|");e.columns(0).search(a,regex=!0,smart=!1).draw()}}function clearExpressionPlot(e){e.expressionView&&(e.expressionView.data("table",[]),e.expressionView.signal("title_signal",""),e.expressionView.signal("max_count",0),e.expressionView.runAsync(),updateAxisMessage(e))}function updateExpressionPlot(e,t,n){let i=t.groups.group,a=t.groups.sample,o=t.levels,s=[];for(col in e){if(!a.includes(col))continue;let r={},l=i[a.indexOf(col)];r.group=l,r.sample=col,r.count=e[col],s.push(r)}null!=o&&s.sort((e,t)=>o.indexOf(e.group)-o.indexOf(t.group)),t.expressionView.data("table",s),t.expressionView.signal("title_signal","Gene "+n.toString());let d=Math.max(...s.map(e=>e.count));t.expressionView.signal("max_count",Math.round(100*d)/100),t.expressionView.runAsync(),updateAxisMessage(t)}function addAxisMessage(e){var t=e.expressionContainer.getElementsByClassName("vega-bindings")[0],n=document.createElement("div");n.setAttribute("class","alertBox invisible"),e.expressionView.addSignalListener("max_y_axis",function(t,n){updateAxisMessage(e)}),t.appendChild(n)}function updateAxisMessage(e){var t=e.expressionContainer.getElementsByClassName("alertBox")[0];let n=e.expressionView.signal("max_count"),i=e.expressionView.signal("max_y_axis");null==i||""==i||Number(i)>=n?t.setAttribute("class","alertBox invisible"):(t.innerHTML=`Max count value is ${n}`,t.setAttribute("class","alertBox danger"))}function containsGene(e,t){let n=-1,i;for(i=0;i<e.length;i++)if(e[i].gene===t.gene){n=i;break}return n}function remove(e,t){return e.slice(0,t).concat(e.slice(t+1))}